#!/usr/bin/env bash

#: TITLE: crc-utils
#: DATE: 2019-04-23
#: VERSION: 0.1.0
#: AUTHOR: "Alex Y" <aleksandryackovlev@yandex.ru>
#: DESCRIPTION: Utils functions

[[ $crcUtilsLoaded ]] && return

source ./crc-env

# DESCRIPTION: Checks if a argument is a number
# USAGE: isNumber ARGUMENT
isNumber() {
  case $1 in
    *[!0-9]*)
      false
    ;;
    *)
      true
    ;;
  esac
}

# DESCRIPTION: Print an error message and exit with the given status code
# USAGE: die STATUS [MESSAGE]
die() {
  local error

  error="$1"

  if ! isNumber "$error"; then
    error="$(crc-env generalErrorCode)"
  fi

  if [[ -n $2 ]]; then
    printf "%s\n" "$2" >&2
  fi

  exit "$error"
}

# DESCRIPTION: The entry point for the utils functions
# USAGE: crc-utils [COMMAND] [ARGUMENTS]
crc-utils() {
  local commandToExec
  commandToExec="$1"
  shift

  case $commandToExec in
    die)
        die "$@"
      ;;
    isNumber)
        isNumber "$1"
      ;;
    *)
        die "$(crc-env misuseErrorCode)" "An unknown command crc-utils ""$commandToExec"
      ;;
  esac
}

crcUtilsLoaded=1
